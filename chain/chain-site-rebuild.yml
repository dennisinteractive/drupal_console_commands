# Usage: drupal site:rebuild --placeholder="name:subscriptions"
command:
  name: site:rebuild
  description: 'Performs multiple commands to build a site (without git checkout)'
commands:
# Clear php opcode cache
  - command: exec
    arguments:
      bin: 'sudo service php-fpm restart'
# Clear memcache
  - command: exec
    arguments:
      bin: 'sudo service memcached restart'
# Run composer
  - command: site:compose
    arguments:
      name: '%{{name}}'
# Run npm
  - command: site:npm
    options:
      placeholder:
        - 'name:%{{name}}'
# Run grunt
  - command: site:grunt
    options:
      placeholder:
        - 'name:%{{name}}'
# Create settings.db.php
  - command: site:settings:db
    arguments:
      name: '%{{name}}'
# Create phpunit.xml
  - command: site:phpunit:setup
    arguments:
      name: '%{{name}}'
# Create behat.yml
  - command: site:behat:setup
    arguments:
      name: '%{{name}}'
# Create settings.memcache.php
  - command: site:settings:memcache
    arguments:
      name: '%{{name}}'
    options:
      memcache-prefix: '%{{name}}'
# Imports db or installs a site
  - command: site:db:import
    arguments:
      name: '%{{name}}'
# Import configuration
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush cim -y;'
# Run db updates
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush updb -y;'
# Import configuration again to fix a problem with config import when new modules are added to core.extensions.yml
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush cim -y;'
# Clear cache
  - command: exec
    arguments:
      bin: 'cd /vagrant/repos/%{{name}}/web; drush cr;'
